      - name: Commit generated subtitles (robust)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Find generated subtitle files
          mapfile -t SUB_FILES < <(find . -maxdepth 6 -type f \( -iname "*.srt" -o -iname "*.vtt" \) -print)

          if [ ${#SUB_FILES[@]} -eq 0 ]; then
            echo "No subtitle files found to commit."
            exit 0
          fi

          echo "Subtitle files to commit:"
          for f in "${SUB_FILES[@]}"; do
            echo " - $f"
          done

          # Stage files safely preserving spaces
          git add -- "${SUB_FILES[@]}"

          echo "Files staged (git status):"
          git status --short

          if git diff --cached --quiet; then
            echo "No subtitle changes to commit."
            exit 0
          fi

          git commit -m "Auto-generated subtitles [skip ci]"
          git push origin HEAD:${{ github.ref_name }}
